---
const { chatbotLabel = "ðŸ’¬ Chat" } = Astro.props;
---

<footer class="site-footer">
  <div class="footer-grid">
    <div class="footer-columns">
      <div class="footer-brand">
        <img
          src="/logo/USRad-Logo-final.png"
          alt="USRad Logo"
          class="footer-logo"
        />
        <p class="footer-copy">&copy; 2025 USRad. All rights reserved.</p>
      </div>

      <div>
        <h4>Explore</h4>
        <ul>
          <li><a href="#how-it-works">How It Works</a></li>
          <li><a href="#pricing">Pricing</a></li>
          <li><a href="#faq">FAQ</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>

      <div>
        <h4>Support</h4>
        <ul>
          <li><a href="#">Patient Login</a></li>
          <li><a href="#">Provider Portal</a></li>
          <li><a href="#">Request Imaging</a></li>
        </ul>
      </div>

      <div>
        <h4>Legal</h4>
        <ul>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">HIPAA Compliance</a></li>
        </ul>
      </div>

      <div>
        <h4>Connect</h4>
        <ul class="connect-list">
          <li>
            <a href="#" class="social-link">
              <img src="/icons/facebook.svg" alt="Facebook" />
              <span>Facebook</span>
            </a>
          </li>
          <li>
            <a href="#" class="social-link">
              <img src="/icons/twitter.svg" alt="Twitter" />
              <span>Twitter</span>
            </a>
          </li>
          <li>
            <a href="#" class="social-link">
              <img src="/icons/linkedin.svg" alt="LinkedIn" />
              <span>LinkedIn</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Chatbot Toggle -->
  <button
    class="chatbot-toggle"
    aria-label="Open Chat"
    onclick="toggleChatbot()"
  >
    {chatbotLabel}
  </button>

  <!-- Chatbot Window -->
  <div id="chatbot-window" class="chatbot-window hidden">
    <div class="chatbot-header">
      AI Assistant <button onclick="toggleChatbot()">âœ–</button>
    </div>
    <div id="chat-log" class="chat-log"></div>
    <form id="chat-form" class="chat-form">
      <input
        type="text"
        id="chat-input"
        placeholder="Ask a question..."
        autocomplete="off"
        required
      />
      <button type="submit">Send</button>
    </form>
  </div>
</footer>

<style>
  .site-footer {
    background-color: #ffffff;
    color: #0e1b2a;
    padding: 4rem 2rem 2rem;
    font-size: 0.875rem;
    position: relative;
  }

  .footer-grid {
    max-width: 1200px;
    margin: 0 auto;
  }

  .footer-columns {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 2rem;
    text-align: left;
  }

  .footer-brand {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .footer-logo {
    max-width: 160px;
  }

  .footer-copy {
    font-size: 0.75rem;
    color: #475569;
  }

  .footer-columns h4 {
    font-size: 1rem;
    margin-bottom: 1rem;
    color: #0e1b2a;
  }

  .footer-columns ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .footer-columns li {
    margin-bottom: 0.5rem;
  }

  .footer-columns a {
    color: #0e1b2a;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .footer-columns a:hover {
    color: #e6c378;
  }

  .connect-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .social-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #0e1b2a;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .social-link:hover {
    color: #e6c378;
  }

  .social-link img {
    width: 20px;
    height: 20px;
  }

  .chatbot-toggle {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    background-color: #eab308;
    color: #0f172a;
    border: none;
    padding: 0.75rem 1.25rem;
    border-radius: 2rem;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
    z-index: 9999;
  }

  .chatbot-window {
    transition:
      transform 0.3s ease,
      opacity 0.3s ease;
    transform: translateY(20px);
    opacity: 0;
    pointer-events: none;
    position: fixed;
    bottom: 4.5rem;
    right: 1.5rem;
    width: 300px;
    max-height: 400px;
    background: #ffffff;
    border: 1px solid #ccc;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    z-index: 10000;
  }

  .chatbot-window.visible {
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  .hidden {
    display: none;
  }

  .chatbot-header {
    background: #0f172a;
    color: #fff;
    padding: 0.75rem;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .chat-log {
    flex: 1;
    padding: 0.75rem;
    overflow-y: auto;
    font-size: 0.85rem;
  }

  .chat-form {
    display: flex;
    border-top: 1px solid #eee;
  }

  .chat-form input {
    flex: 1;
    border: none;
    padding: 0.5rem;
    font-size: 0.85rem;
  }

  .chat-form button {
    background: #0f172a;
    color: white;
    border: none;
    padding: 0 1rem;
    cursor: pointer;
  }
</style>

<script>
  function toggleChatbot() {
    const chat = document.getElementById("chatbot-window");
    if (chat.classList.contains("visible")) {
      chat.classList.remove("visible");
      setTimeout(() => chat.classList.add("hidden"), 300);
    } else {
      chat.classList.remove("hidden");
      requestAnimationFrame(() => chat.classList.add("visible"));
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");
    const chatLog = document.getElementById("chat-log");

    if (chatForm && chatInput && chatLog) {
      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (!message) return;

        chatLog.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
        chatInput.value = "";

        try {
          const response = await fetch("http://localhost:11434/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              model: "llama3",
              messages: [{ role: "user", content: message }],
            }),
          });

          const data = await response.json();
          const reply = data.message?.content || "[No response]";
          chatLog.innerHTML += `<div><strong>Bot:</strong> ${reply}</div>`;
          chatLog.scrollTop = chatLog.scrollHeight;
        } catch (err) {
          chatLog.innerHTML += `<div><strong>Bot:</strong> Error contacting server</div>`;
        }
      });
    }
  });
</script>
